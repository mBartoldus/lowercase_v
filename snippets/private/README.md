These are the private functions. Don't look at them too long they might break.